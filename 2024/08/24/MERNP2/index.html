<!DOCTYPE html><html lang="zh-TW"><head><meta charset="utf-8"><title>MERN 專案STEP | HenRsの小窩</title><meta name="author" content="HenRs"><meta name="description" content="有關於『我』"><meta name="keywords" content=""><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><link rel="icon" href="/images/avatar.webp"><link rel="preconnect" href="https://s4.zstatic.net"><script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"><link rel="preconnect" href="https://fonts.googleapis.cn"><link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"><script>const mixins={}</script><script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script><script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script><script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"><script src="/js/lib/highlight.js"></script><script src="/js/lib/preview.js"></script><link rel="stylesheet" href="/css/main.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="layout"><transition name="fade"><div id="loading" v-show="loading"><div id="loading-circle"><h2>LOADING</h2><p>加載中···請稍後，如過慢請清理緩存</p><img src="/images/loading.gif"></div></div></transition><div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}"><nav id="desktop-menu"><a class="title" href="/"><span>HENRSの小窩</span> </a><a href="/"><i class="fa-solid fa-house fa-fw"></i> <span>&ensp;首頁</span> </a><a href="/about"><i class="fa-solid fa-id-card fa-fw"></i> <span>&ensp;關於</span> </a><a href="/archives"><i class="fa-solid fa-box-archive fa-fw"></i> <span>&ensp;項目</span> </a><a href="/categories"><i class="fa-solid fa-bookmark fa-fw"></i> <span>&ensp;類別</span> </a><a href="/tags"><i class="fa-solid fa-tags fa-fw"></i> <span>&ensp;標籤</span></a></nav><nav id="mobile-menu"><div class="title" @click="showMenuItems = !showMenuItems"><i class="fa-solid fa-bars fa-fw"></i> <span>&emsp;HENRSの小窩</span></div><transition name="slide"><div class="items" v-show="showMenuItems"><a href="/"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-house fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">首頁</div></div></a><a href="/about"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-id-card fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">關於</div></div></a><a href="/archives"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-box-archive fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">項目</div></div></a><a href="/categories"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-bookmark fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">類別</div></div></a><a href="/tags"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-tags fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">標籤</div></div></a></div></transition></nav></div><transition name="fade"><div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div></transition><div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'"><div class="article"><div><h1>MERN 專案STEP</h1></div><div class="info"><span class="date"><span class="icon"><i class="fa-solid fa-calendar fa-fw"></i> </span>2024/8/24</span></div><div class="content" v-pre><h3 id="7-在-serverjs-內-將剛剛新建的-routes-給連結進來"><a class="markdownIt-Anchor" href="#7-在-serverjs-內-將剛剛新建的-routes-給連結進來"></a> 7. 在 server.js 內 將剛剛新建的 Routes 給連結進來</h3><pre class="highlight"><code class="js">const authRoute = require(&quot;./routes&quot;).auth;

app.use(&quot;/api/user&quot;, authRoute);
</code></pre><h3 id="8-在-serverjs-內-將-express等相關插件導入"><a class="markdownIt-Anchor" href="#8-在-serverjs-內-將-express等相關插件導入"></a> 8. 在 server.js 內 將 express…等相關插件導入</h3><pre class="highlight"><code class="bash">npm install cors // 跨平台所需的
</code></pre><pre class="highlight"><code class="js">const express = require(&quot;express&quot;);
const app = express();
const cors = require(&quot;cors&quot;);

app.use(express.json()); //express 必須
pp.use(express.urlencoded(&#123; extended: true &#125;)); //express post 解碼必須
app.use(cors());

app.listen(8080, () =&gt; &#123;
  console.log(&quot;正在運行在8080&quot;);
&#125;);
</code></pre><h1 class="stfont" id="如有設置-auth-外的-routes-未有則跳過"><a class="markdownIt-Anchor" href="#如有設置-auth-外的-routes-未有則跳過"></a> 如有設置 auth 外的 routes ，未有則跳過</h1><p> </p><h3 id="9-在根目錄新建一個-cofing-資料夾並建立-passportjs"><a class="markdownIt-Anchor" href="#9-在根目錄新建一個-cofing-資料夾並建立-passportjs"></a> 9. 在根目錄新建一個 cofing 資料夾，並建立 passport.js</h3><p>先安裝 passport-jwt 與 passport-local</p><ul><li><a target="_blank" rel="noopener" href="https://www.passportjs.org/packages/passport-jwt/">passport-jwt</a></li><li><a target="_blank" rel="noopener" href="https://www.passportjs.org/packages/passport-local/">passport-local</a></li></ul><pre class="highlight"><code class="bash">npm install passport-jwt
npm install passport-local
</code></pre><pre class="highlight"><code class="js">let JwtStrategy = require(&quot;passport-jwt&quot;).Strategy;
let ExtractJwt = require(&quot;passport-jwt&quot;).ExtractJwt;
const User = require(&quot;../model&quot;).user;

module.exports = (passport) =&gt; &#123;
  let opts = &#123;&#125;;
  opts.jwtFromRequest = ExtractJwt.fromAuthHeaderWithScheme(&quot;jwt&quot;);
  //這個方法由前綴中提取 JWT，前提是 JWT 存在於以 jwt 为前缀的。
  opts.secretOrKey = process.env.PASSPORT_SECRET;
  // 當前配置.env 環境中的 secretOrKey 用來檢測 網站有無被非法盜用

  passport.use(
    new JwtStrategy(opts, async function (jwt_payload, done) &#123;
      try &#123;
        let FUser = await User.findOne(&#123; _id: jwt_payload._id &#125;).exec();
        //jwt_payload 回傳一個obj 裡面包含 email,_id,iat 但我們只要取_id 來查找身份
        if (FUser) &#123;
          return done(null, FUser);
        &#125; else &#123;
          return done(null, false, &#123; message: &quot;No user found&quot; &#125;); // 没有找到用户时，返回 false
        &#125;
      &#125; catch (e) &#123;
        return done(e, false);
      &#125;
    &#125;)
  );
&#125;;
</code></pre><h3 id="10-在-serverjs-將-passport-的-fc-導入"><a class="markdownIt-Anchor" href="#10-在-serverjs-將-passport-的-fc-導入"></a> 10. 在 server.js 將 passport 的 fc 導入</h3><pre class="highlight"><code class="js">const passport = require(&quot;passport&quot;);
require(&quot;./config/passport&quot;)(passport);

app.use(
  &quot;/api/course&quot;,
  passport.authenticate(&quot;jwt&quot;, &#123; session: false &#125;), //JWT 作為無狀態的認證方式，而不是依赖 session 來保存信息
  courseRoute //如通過認證 才會進到這個Routes裡面
);
</code></pre><h3 id="11-在根目錄創建一個env-並根據步驟-9-設定"><a class="markdownIt-Anchor" href="#11-在根目錄創建一個env-並根據步驟-9-設定"></a> 11. 在根目錄創建一個.env 並根據步驟 9 設定</h3><pre class="highlight"><code class="text">PASSPORT_SECRET=&quot;你自己設定的值&quot;
</code></pre><p class="centerP"><strong>恭喜完成後端部分的設定</strong></p><hr><h2 id="前端-react-部分"><a class="markdownIt-Anchor" href="#前端-react-部分"></a> 前端 React 部分</h2><p> <br> </p><h2 id="專案步驟與核心功能"><a class="markdownIt-Anchor" href="#專案步驟與核心功能"></a> 專案步驟與核心功能</h2><h3 id="1-打開-cmd-並貼上以下指令並將檔案移至與-serverjs-相同的資料夾"><a class="markdownIt-Anchor" href="#1-打開-cmd-並貼上以下指令並將檔案移至與-serverjs-相同的資料夾"></a> 1. 打開 cmd 並貼上以下指令，並將檔案移至與 server.js 相同的資料夾</h3><pre class="highlight"><code class="bash">cd Desktop
npx create-react-app client
</code></pre><h3 id="2-刪除-clinet-內部不必要的檔案"><a class="markdownIt-Anchor" href="#2-刪除-clinet-內部不必要的檔案"></a> 2. 刪除 clinet 內部不必要的檔案</h3><pre class="highlight"><code class="plaintext">src 內部 只留下App.js 和 index.js
public 內部 只留index.html
</code></pre><h3 id="3-安裝-react-router-dom"><a class="markdownIt-Anchor" href="#3-安裝-react-router-dom"></a> 3. 安裝 react-router-dom</h3><pre class="highlight"><code class="bash">cd Desktop
cd &quot;server的資料夾&quot;
cd client
npm i react-router-dom
</code></pre><h3 id="4-創建一個-component-的資料夾並建立-homejs-與-layoutjs"><a class="markdownIt-Anchor" href="#4-創建一個-component-的資料夾並建立-homejs-與-layoutjs"></a> 4. 創建一個 Component 的資料夾，並建立 Home.js 與 Layout.js</h3><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/1410822048/My-storehouse@main/home-component.js">Home.js</a></p><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/1410822048/My-storehouse@main/Layout.js">Layout.js</a></p><h3 id="5-在-appjs-內將-react-router-dom-導入"><a class="markdownIt-Anchor" href="#5-在-appjs-內將-react-router-dom-導入"></a> 5. 在 App.js 內將 react-router-dom 導入</h3><pre class="highlight"><code class="js">import &#123; BrowserRouter, Routes, Route &#125; from &quot;react-router-dom&quot;;
import Layout from &quot;./components/Layout&quot;;
import Home from &quot;./components/home-component&quot;;

function App() &#123;
  return (
    &lt;BrowserRouter&gt;
      &lt;Routes&gt;
        &lt;Route path=&quot;/&quot;element=&#123;&lt;Layout /&gt;&#125;&gt;
          &lt;Route index element=&#123;&lt;Home /&gt;&#125;/&gt;
        &lt;Route&gt;
      &lt;Routes&gt;
    &lt;BrowserRouter&gt;
  )
&#125;
</code></pre><h3 id="6-基於網頁構成是用-bootstrap-故在-indexhtml-需貼上相應連結"><a class="markdownIt-Anchor" href="#6-基於網頁構成是用-bootstrap-故在-indexhtml-需貼上相應連結"></a> 6. 基於網頁構成是用 bootstrap ，故在 index.html 需貼上相應連結</h3><pre class="highlight"><code class="HTML">  &lt;head&gt;
    &lt;link
      href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css&quot;
      rel=&quot;stylesheet&quot;
      integrity=&quot;sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH&quot;
      crossorigin=&quot;anonymous&quot;
    /&gt;
    &lt;script
      src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js&quot;
      integrity=&quot;sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz&quot;
      crossorigin=&quot;anonymous&quot;
    &gt;&lt;/script&gt;
  &lt;/head&gt;
</code></pre><h3 id="7-安裝-axios-套件並建立一個-services-的資料夾"><a class="markdownIt-Anchor" href="#7-安裝-axios-套件並建立一個-services-的資料夾"></a> 7. 安裝 axios 套件，並建立一個 services 的資料夾</h3><pre class="highlight"><code class="bash">cd client
npm i axios
</code></pre><p>建立 auth.service 的檔案，並記得跟後端所配合的 Routes 同個請求方式</p><pre class="highlight"><code class="js">import axios from &quot;axios&quot;;
const API_URL = &quot;http://localhost:8080/api/user&quot;;

class AuthService &#123;
  login(email, password) &#123;
    //登入用
    return axios.post(API_URL + &quot;/login&quot;, &#123;
      email,
      password,
    &#125;);
  &#125;
  logout() &#123;
    // 登出用
    localStorage.removeItem(&quot;user&quot;);
  &#125;
  register(username, email, password, role) &#123;
    //註冊用
    return axios.post(API_URL + &quot;/register&quot;, &#123;
      username,
      email,
      password,
      role,
    &#125;);
  &#125;
  getCurrentUser() &#123;
    //取得當前使用者
    return JSON.parse(localStorage.getItem(&quot;user&quot;));
  &#125;
  editCurrentUserProfile(_id, updatedData) &#123;
    //更新使用者資訊
    let token;
    if (localStorage.getItem(&quot;user&quot;)) &#123;
      token = JSON.parse(localStorage.getItem(&quot;user&quot;)).token;
    &#125; else &#123;
      token = &quot;&quot;;
    &#125;
    return axios.patch(`$&#123;API_URL&#125;/$&#123;_id&#125;`, updatedData, &#123;
      headers: &#123;
        Authorization: token,
      &#125;,
    &#125;);
  &#125;
&#125;
const authServiceInstance = new AuthService();
export default authServiceInstance;
</code></pre><div class="pagination"><a href="#" class="page-link" data-page-prefix="MERN" data-page="1">1</a> <a href="#" class="page-link" data-page-prefix="MERN" data-page="2">2</a> <a href="#" class="page-link" data-page-prefix="MERN" data-page="3">3</a></div></div></div><footer id="footer"><div id="footer-wrap"><div>&copy; 2024 - 2025 HenRsの小窩 <span id="footer-icon"><i class="fa-solid fa-font-awesome fa-fw"></i> </span>&commat;HenRs</div><div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp; <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a></div></div></footer></div><transition name="fade"><div id="preview" ref="preview" v-show="previewShow"><img id="preview-content" ref="previewContent"></div></transition></div><script src="/js/main.js" defer></script><canvas id="fireworks" style="position:fixed;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:32767"></canvas><script src="https://s4.zstatic.net/ajax/libs/animejs/3.2.1/anime.min.js"></script><script src="/js/fireworks.min.js" defer></script><script src="/js/commonpage.min.js" defer></script></body></html>