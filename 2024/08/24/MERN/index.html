
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8" />
    <title>MERN å°ˆæ¡ˆSTEP | HenRsã®å°çª©</title>
    <meta name="author" content="HenRs" />
    <meta name="description" content="æœ‰é—œæ–¼ã€æˆ‘ã€" />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/avatar.webp" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<!-- <link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" /> -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />
<meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>åŠ è¼‰ä¸­Â·Â·Â·è«‹ç¨å¾Œï¼Œå¦‚éæ…¢è«‹æ¸…ç†ç·©å­˜</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>HENRSã®å°çª©</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;é¦–é </span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;é—œæ–¼</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;é …ç›®</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;é¡åˆ¥</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;æ¨™ç±¤</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;HENRSã®å°çª©</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">é¦–é </div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">é—œæ–¼</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">é …ç›®</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">é¡åˆ¥</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">æ¨™ç±¤</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    <div>
        <h1>MERN å°ˆæ¡ˆSTEP</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/8/24
        </span>
        
        <span class="category">
            <a href="/categories/%E4%BD%9C%E5%93%81/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                ä½œå“
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            
            <span class="tag">
                
                <a href="/tags/MERN/" style="color: #ffa2c4">
                    MERN
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/MongoDB/" style="color: #00a596">
                    MongoDB
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/Express/" style="color: #00bcd4">
                    Express
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/React/" style="color: #ff7d73">
                    React
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/Node-js/" style="color: #ffa2c4">
                    Node.js
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/%E5%85%A8%E7%AB%AF%E9%96%8B%E7%99%BC/" style="color: #03a9f4">
                    å…¨ç«¯é–‹ç™¼
                </a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        <h2 id="ä»€éº¼æ˜¯-mern-stack"><a class="markdownIt-Anchor" href="#ä»€éº¼æ˜¯-mern-stack"></a> ä»€éº¼æ˜¯ MERN Stackï¼Ÿ</h2>
<p>MERN ä»£è¡¨ <strong>MongoDB, Express, React, Node.js</strong>ï¼Œæ˜¯ä¸€å¥—å¼·å¤§çš„å…¨ç«¯é–‹ç™¼æŠ€è¡“æ£§ï¼Œè®“é–‹ç™¼è€…èƒ½å¤ ä»¥ <strong>JavaScript</strong> æ‰“é€ å¾å¾Œç«¯åˆ°å‰ç«¯çš„å®Œæ•´æ‡‰ç”¨ç¨‹å¼ã€‚</p>
<ul>
<li><strong>MongoDB</strong>: NoSQL è³‡æ–™åº«ï¼Œé©åˆå„²å­˜ JSON æ ¼å¼çš„æ–‡ä»¶å‹è³‡æ–™ã€‚</li>
<li><strong>Express</strong>: Node.js ä¸Šçš„è¼•é‡æ¡†æ¶ï¼Œæä¾›å¾Œç«¯ API å’Œä¸­ä»‹è»Ÿé«”åŠŸèƒ½ã€‚</li>
<li><strong>React</strong>: ç”¨æ–¼å»ºæ§‹å‰ç«¯ç”¨æˆ¶ç•Œé¢ (UI) çš„ JavaScript å‡½å¼åº«ã€‚</li>
<li><strong>Node.js</strong>: æä¾›å¾Œç«¯é‹è¡Œç’°å¢ƒï¼Œå¯åŸ·è¡Œ JavaScript ç¨‹å¼ç¢¼ã€‚</li>
</ul>
<span id="more"></span>
<hr />
<h2 id="mern-å°ˆæ¡ˆæ¶æ§‹æ¦‚è¦½"><a class="markdownIt-Anchor" href="#mern-å°ˆæ¡ˆæ¶æ§‹æ¦‚è¦½"></a> MERN å°ˆæ¡ˆæ¶æ§‹æ¦‚è¦½</h2>
<p>ä¸€å€‹å…¸å‹çš„ MERN å°ˆæ¡ˆæœƒåŒ…å«ä»¥ä¸‹çµæ§‹ï¼š</p>
<pre class="highlight"><code class="text">my-mern-project/
â”œâ”€â”€ backend/                 # å¾Œç«¯ç¨‹å¼ç¢¼
â”‚   â”œâ”€â”€ models/              # MongoDB è³‡æ–™æ¨¡å‹
â”‚   â”œâ”€â”€ routes/              # Express è·¯ç”±å’Œ API
â”‚   â””â”€â”€ server.js            # Node.js ä¼ºæœå™¨å…¥å£
â”œâ”€â”€ frontend/                # å‰ç«¯ç¨‹å¼ç¢¼
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/      # React çµ„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/           # æ‡‰ç”¨ç¨‹å¼é é¢
â”‚   â”‚   â””â”€â”€ App.js           # React æ‡‰ç”¨å…¥å£
â”œâ”€â”€ .env                     # ç’°å¢ƒè®Šæ•¸é…ç½®
â”œâ”€â”€ package.json             # ä¾è³´èˆ‡è…³æœ¬è¨­å®š
â””â”€â”€ README.md                # å°ˆæ¡ˆèªªæ˜æ–‡ä»¶

</code></pre>
<h2 id="å°ˆæ¡ˆæ­¥é©Ÿèˆ‡æ ¸å¿ƒåŠŸèƒ½"><a class="markdownIt-Anchor" href="#å°ˆæ¡ˆæ­¥é©Ÿèˆ‡æ ¸å¿ƒåŠŸèƒ½"></a> å°ˆæ¡ˆæ­¥é©Ÿèˆ‡æ ¸å¿ƒåŠŸèƒ½</h2>
<h3 id="1-æ‰“é–‹-vs-code-å…ˆåœ¨çµ‚ç«¯é‹è¡Œä»¥ä¸‹æŒ‡ä»¤å¦‚æœªç‰¹åˆ¥è¨­ç½®å…¨éƒ½é»˜èªå³å¯"><a class="markdownIt-Anchor" href="#1-æ‰“é–‹-vs-code-å…ˆåœ¨çµ‚ç«¯é‹è¡Œä»¥ä¸‹æŒ‡ä»¤å¦‚æœªç‰¹åˆ¥è¨­ç½®å…¨éƒ½é»˜èªå³å¯"></a> 1. æ‰“é–‹ VS Code å…ˆåœ¨çµ‚ç«¯é‹è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼Œå¦‚æœªç‰¹åˆ¥è¨­ç½®å…¨éƒ½é»˜èªå³å¯</h3>
<pre class="highlight"><code class="bash">npm init
npm install express dotenv bcrypt mongoose
</code></pre>
<h3 id="2-è¨­ç½®-mongodb-è³‡æ–™åº«"><a class="markdownIt-Anchor" href="#2-è¨­ç½®-mongodb-è³‡æ–™åº«"></a> 2. è¨­ç½® MongoDB è³‡æ–™åº«</h3>
<p>åœ¨ MongoDB Atlas æˆ–æœ¬åœ°ç«¯è¨­ç½®è³‡æ–™åº«ï¼Œä¸¦é€£çµåˆ°å°ˆæ¡ˆï¼š</p>
<pre class="highlight"><code class="js"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;mongoose&quot;</span>);
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MONGO_URI</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">MONGO_URI</span>;
<span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;dotenv&quot;</span>).<span class="hljs-title function_">config</span>();

mongoose
  .<span class="hljs-title function_">connect</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">MONGO_URI</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;MongoDB é€£ç·šæˆåŠŸ&quot;</span>))
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;MongoDB é€£ç·šå¤±æ•—:&quot;</span>, err));
</code></pre>
<h3 id="3-å»ºç«‹-user-åŠ-å…¶ä»–è³‡æ–™çš„ç›¸é—œ-model"><a class="markdownIt-Anchor" href="#3-å»ºç«‹-user-åŠ-å…¶ä»–è³‡æ–™çš„ç›¸é—œ-model"></a> 3. å»ºç«‹ User åŠ å…¶ä»–è³‡æ–™çš„ç›¸é—œ Model</h3>
<p>åŸºç¤çš„ Schema æ¢ä»¶å»ºç½®ï¼š</p>
<pre class="highlight"><code class="js"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;mongoose&quot;</span>);
<span class="hljs-keyword">const</span> &#123; <span class="hljs-title class_">Schema</span> &#125; = mongoose;

<span class="hljs-keyword">const</span> userSchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>(&#123;
  <span class="hljs-attr">username</span>: &#123;
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">minlength</span>: [<span class="hljs-number">3</span>, <span class="hljs-string">&quot;è«‹è‡³å°‘è¼¸å…¥ä¸‰å€‹å­—å…ƒ&quot;</span>],
    <span class="hljs-attr">maxlength</span>: [<span class="hljs-number">12</span>, <span class="hljs-string">&quot;è¶…å‡ºå­—æ•¸é™åˆ¶!!&quot;</span>],
  &#125;,
  <span class="hljs-attr">email</span>: &#123;
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">minlength</span>: [<span class="hljs-number">5</span>, <span class="hljs-string">&quot;è«‹è‡³å°‘è¼¸å…¥äº”å€‹å­—å…ƒ&quot;</span>],
    <span class="hljs-attr">maxlength</span>: [<span class="hljs-number">25</span>, <span class="hljs-string">&quot;è¶…å‡ºå­—å…ƒé™åˆ¶!!&quot;</span>],
  &#125;,
  <span class="hljs-attr">password</span>: &#123;
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">minlength</span>: [<span class="hljs-number">8</span>, <span class="hljs-string">&quot;Password must be at least 8 characters&quot;</span>],
    <span class="hljs-attr">maxlengeh</span>: [<span class="hljs-number">15</span>, <span class="hljs-string">&quot;Password must be less than 15 characters&quot;</span>],
    <span class="hljs-attr">validate</span>: &#123;
      <span class="hljs-attr">validator</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">v</span>) &#123;
        <span class="hljs-comment">// æª¢æŸ¥æ˜¯å¦åŒ…å«è‡³å°‘ä¸€å€‹å­—æ¯å’Œä¸€å€‹æ•¸å­—ï¼Œä½†å¾ŒçºŒæœƒé€é&#x27;JOI&#x27;é€™å€‹æ’ä»¶å¯¦ç¾ é€™é‚Šåªæ˜¯ç”¨æ–¼è¨˜æ†¶</span>
        <span class="hljs-keyword">return</span> <span class="hljs-regexp">/^(?=.*[A-Za-z])(?=.*\d)/</span>.<span class="hljs-title function_">test</span>(v);
      &#125;,
      <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;Password must contain at least one letter and one number&quot;</span>,
    &#125;,
  &#125;,
  <span class="hljs-attr">role</span>: &#123;
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">enum</span>: [<span class="hljs-string">&quot;Student&quot;</span>, <span class="hljs-string">&quot;Instructor&quot;</span>],
  &#125;,
  <span class="hljs-attr">date</span>: &#123;
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Date</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-property">now</span>,
  &#125;,
&#125;);
</code></pre>
<p>å»ºç«‹ mdoel çš„è¦å‰‡ä¸¦é€é bcrypt åŠ å¯†ï¼Œä¸¦åœ¨ save å‹•ä½œå‰è§¸ç™¼ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/bcrypt">bcrypt</a></li>
</ul>
<pre class="highlight"><code class="js"><span class="hljs-keyword">const</span> bcrypt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;bcrypt&quot;</span>);
<span class="hljs-keyword">const</span> saltRounds = <span class="hljs-number">14</span>; <span class="hljs-comment">//åŠ å¯†è¤‡é›œåº¦ å»ºè­°åœ¨10-14é–“ step = 2</span>

userSchema.<span class="hljs-property">methods</span>.<span class="hljs-property">isStudent</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">role</span> == <span class="hljs-string">&quot;Student&quot;</span>; <span class="hljs-comment">//ç„¡æ³•ç”¨ arrow fc æœƒæŠ“ä¸åˆ° this</span>
&#125;;

userSchema.<span class="hljs-property">methods</span>.<span class="hljs-property">isInstructor</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">role</span> == <span class="hljs-string">&quot;Instructor&quot;</span>;
&#125;;

userSchema.<span class="hljs-property">methods</span>.<span class="hljs-property">comparePassword</span> = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">password, cb</span>) &#123;
  <span class="hljs-keyword">let</span> result;
  <span class="hljs-keyword">try</span> &#123;
    result = <span class="hljs-keyword">await</span> bcrypt.<span class="hljs-title function_">compare</span>(password, <span class="hljs-variable language_">this</span>.<span class="hljs-property">password</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">cb</span>(<span class="hljs-literal">null</span>, result);
  &#125; <span class="hljs-keyword">catch</span> (e) &#123;
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">cb</span>(e, result);
  &#125;
&#125;;

userSchema.<span class="hljs-title function_">pre</span>(<span class="hljs-string">&quot;save&quot;</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">next</span>) &#123;
  <span class="hljs-comment">//è¡¨ç¤ºåœ¨ save å‰è§¸ç™¼æ­¤ fc</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isNew</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isModified</span>(<span class="hljs-string">&quot;password&quot;</span>)) &#123;
    <span class="hljs-comment">//isNew ç¢ºèªæ˜¯å¦ç‚ºæ–°æ–‡æª” || isModified ç¢ºèªæ˜¯å¦ç¶“ä¿®æ”¹é å…©è€…ç‚º mongoose å…§å»ºå‡½æ•¸</span>
    <span class="hljs-keyword">const</span> hashedPass = <span class="hljs-keyword">await</span> bcrypt.<span class="hljs-title function_">hash</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">password</span>, saltRounds);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">password</span> = hashedPass;
  &#125;
  <span class="hljs-title function_">next</span>();
  <span class="hljs-comment">//æŠŠä¸»å‹•æ¬Šäº¤çµ¦ä¸‹ä¸€å€‹ middleware</span>
&#125;);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&quot;User&quot;</span>, userSchema);
</code></pre>
<h3 id="4-é€é-joi-å»ºç«‹å„é …é©—è­‰"><a class="markdownIt-Anchor" href="#4-é€é-joi-å»ºç«‹å„é …é©—è­‰"></a> 4. é€é JOI å»ºç«‹å„é …é©—è­‰</h3>
<p>ç”¨æ–¼é©—è­‰ç”¨æˆ¶ç¶“é Routes çš„æ•¸æ“šæ˜¯å¦ç¬¦åˆè¦æ±‚ ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/joi">Joi</a></li>
</ul>
<pre class="highlight"><code class="js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Joi</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;joi&quot;</span>);

<span class="hljs-keyword">const</span> <span class="hljs-title function_">registorValidation</span> = (<span class="hljs-params">data</span>) =&gt; &#123;
  <span class="hljs-keyword">const</span> schema = <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">object</span>(&#123;
    <span class="hljs-attr">username</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">min</span>(<span class="hljs-number">3</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">12</span>).<span class="hljs-title function_">required</span>().<span class="hljs-title function_">messages</span>(&#123;
      <span class="hljs-string">&quot;string.min&quot;</span>: <span class="hljs-string">&quot;ç”¨æˆ¶åç¨±é•·åº¦è‡³å°‘ 3 å€‹å­—å…ƒã€‚&quot;</span>,
      <span class="hljs-string">&quot;string.max&quot;</span>: <span class="hljs-string">&quot;ç”¨æˆ¶åç¨±é•·åº¦ä¸èƒ½è¶…é 12 å€‹å­—å…ƒã€‚&quot;</span>,
      <span class="hljs-string">&quot;string.empty&quot;</span>: <span class="hljs-string">&quot;ç”¨æˆ¶åç¨±ä¸èƒ½ç‚ºç©ºã€‚&quot;</span>,
      <span class="hljs-string">&quot;any.required&quot;</span>: <span class="hljs-string">&quot;ç”¨æˆ¶åç¨±ç‚ºå¿…å¡«é …ã€‚&quot;</span>,
    &#125;),
    <span class="hljs-attr">email</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">min</span>(<span class="hljs-number">5</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">25</span>).<span class="hljs-title function_">required</span>().<span class="hljs-title function_">email</span>().<span class="hljs-title function_">messages</span>(&#123;
      <span class="hljs-string">&quot;string.min&quot;</span>: <span class="hljs-string">&quot;é›»å­ä¿¡ç®±è‡³å°‘ 3 å€‹å­—å…ƒã€‚&quot;</span>,
      <span class="hljs-string">&quot;string.max&quot;</span>: <span class="hljs-string">&quot;é›»å­ä¿¡ç®±ä¸èƒ½è¶…é 12 å€‹å­—å…ƒã€‚&quot;</span>,
      <span class="hljs-string">&quot;string.email&quot;</span>: <span class="hljs-string">&quot;è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»å­éƒµä»¶åœ°å€ã€‚&quot;</span>,
      <span class="hljs-string">&quot;string.empty&quot;</span>: <span class="hljs-string">&quot;é›»å­ä¿¡ç®±ä¸èƒ½ç‚ºç©ºã€‚&quot;</span>,
      <span class="hljs-string">&quot;any.required&quot;</span>: <span class="hljs-string">&quot;é›»å­ä¿¡ç®±ç‚ºå¿…å¡«é …&quot;</span>,
    &#125;),
    <span class="hljs-attr">password</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">string</span>()
      .<span class="hljs-title function_">min</span>(<span class="hljs-number">8</span>)
      .<span class="hljs-title function_">max</span>(<span class="hljs-number">15</span>)
      .<span class="hljs-title function_">required</span>()
      .<span class="hljs-title function_">pattern</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">&quot;^(?=.*[a-zA-Z])(?=.*[0-9])[a-zA-Z0-9]&#123;8,15&#125;$&quot;</span>))
      .<span class="hljs-title function_">messages</span>(&#123;
        <span class="hljs-string">&quot;string.min&quot;</span>: <span class="hljs-string">&quot;å¯†ç¢¼è‡³å°‘ 8å€‹å­—å…ƒã€‚&quot;</span>,
        <span class="hljs-string">&quot;string.max&quot;</span>: <span class="hljs-string">&quot;å¯†ç¢¼ä¸èƒ½è¶…é 15 å€‹å­—å…ƒã€‚&quot;</span>,
        <span class="hljs-string">&quot;string.pattern.base&quot;</span>:
          <span class="hljs-string">&quot;å¯†ç¢¼å¿…é¡»è‡³å°‘åŒ…å«ä¸€å€‹å­—æ¯å’Œä¸€å€‹æ•¸å­—ï¼Œä¸”é•·åº¦åœ¨ 8 åˆ° 15 å€‹å­—å…ƒä¹‹é–“ã€‚&quot;</span>,
        <span class="hljs-string">&quot;string.empty&quot;</span>: <span class="hljs-string">&quot;å¯†ç¢¼ä¸èƒ½ç‚ºç©ºã€‚&quot;</span>,
        <span class="hljs-string">&quot;any.required&quot;</span>: <span class="hljs-string">&quot;å¯†ç¢¼æ˜¯å¿…å¡«é …ã€‚&quot;</span>,
      &#125;),
    <span class="hljs-attr">role</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">string</span>()
      .<span class="hljs-title function_">valid</span>(<span class="hljs-string">&quot;Student&quot;</span>, <span class="hljs-string">&quot;Instructor&quot;</span>) <span class="hljs-comment">// é™åˆ¶ç‚º &quot;Student&quot; æˆ– &quot;Instructor&quot;</span>
      .<span class="hljs-title function_">required</span>()
      .<span class="hljs-title function_">messages</span>(&#123;
        <span class="hljs-string">&quot;string.empty&quot;</span>: <span class="hljs-string">&quot;èº«ä»½ä¸èƒ½ç‚ºç©ºã€‚&quot;</span>,
        <span class="hljs-string">&quot;any.required&quot;</span>: <span class="hljs-string">&quot;èº«ä»½æ˜¯å¿…å¡«çš„ã€‚&quot;</span>,
        <span class="hljs-string">&quot;any.invalid&quot;</span>: <span class="hljs-string">&quot;èº«ä»½å¿…é ˆæ˜¯ Student æˆ– Instructorã€‚&quot;</span>,
        <span class="hljs-string">&quot;any.only&quot;</span>: <span class="hljs-string">&quot;èº«ä»½å¿…é ˆæ˜¯ Student æˆ– Instructorã€‚&quot;</span>,
      &#125;),
  &#125;);
  <span class="hljs-keyword">return</span> schema.<span class="hljs-title function_">validate</span>(data);
&#125;;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">loginValidation</span> = (<span class="hljs-params">data</span>) =&gt; &#123;
  <span class="hljs-keyword">const</span> schema = <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">object</span>(&#123;
    <span class="hljs-attr">email</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">required</span>().<span class="hljs-title function_">email</span>().<span class="hljs-title function_">messages</span>(&#123;
      <span class="hljs-string">&quot;string.email&quot;</span>: <span class="hljs-string">&quot;ğŸš«æ­¤ä¿¡ç®±å°šæœªè¨»å†Œã€‚&quot;</span>,
      <span class="hljs-string">&quot;string.empty&quot;</span>: <span class="hljs-string">&quot;ğŸš«é›»å­ä¿¡ç®±ä¸èƒ½ç‚ºç©ºã€‚&quot;</span>,
      <span class="hljs-string">&quot;any.required&quot;</span>: <span class="hljs-string">&quot;é›»å­ä¿¡ç®±ç‚ºå¿…å¡«é …ã€‚&quot;</span>,
    &#125;),
    <span class="hljs-attr">password</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">required</span>().<span class="hljs-title function_">messages</span>(&#123;
      <span class="hljs-string">&quot;string.pattern.base&quot;</span>: <span class="hljs-string">&quot;ğŸš«é‚®ç®±æˆ–å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ã€‚&quot;</span>,
      <span class="hljs-string">&quot;string.empty&quot;</span>: <span class="hljs-string">&quot;ğŸš«å¯†ç¢¼ä¸èƒ½ç‚ºç©ºã€‚&quot;</span>,
      <span class="hljs-string">&quot;any.required&quot;</span>: <span class="hljs-string">&quot;å¯†ç¢¼æ˜¯å¿…å¡«é …ã€‚&quot;</span>,
    &#125;),
  &#125;);
  <span class="hljs-keyword">return</span> schema.<span class="hljs-title function_">validate</span>(data);
&#125;;

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">registorValidation</span> = registorValidation;
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">loginValidation</span> = loginValidation;
</code></pre>
<h3 id="5-å»ºç«‹-jwt-é©—è­‰çš„-middleware"><a class="markdownIt-Anchor" href="#5-å»ºç«‹-jwt-é©—è­‰çš„-middleware"></a> 5. å»ºç«‹ JWT é©—è­‰çš„ middleware</h3>
<p>é€é JWT ä¾†é©—è­‰èº«ä»½ç­‰ç›¸é—œè³‡è¨Šï¼š</p>
<pre class="highlight"><code class="bash">npm install jsonwebtoken
</code></pre>
<pre class="highlight"><code class="js"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">JWT</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;jsonwebtoken&quot;</span>); <span class="hljs-comment">//JWT é©—è­‰</span>
<span class="hljs-comment">//é©—è­‰ token</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">authenticateToken</span>(<span class="hljs-params">req, res, next</span>) &#123;
  <span class="hljs-keyword">const</span> token = req.<span class="hljs-title function_">header</span>(<span class="hljs-string">&quot;Authorization&quot;</span>); <span class="hljs-comment">// å¾ Authorization æ¨™é ­ä¸­å–å‡º token</span>

  <span class="hljs-keyword">if</span> (!token) &#123;
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;æ²’æœ‰æä¾› token&quot;</span>);
  &#125;

  <span class="hljs-keyword">const</span> jwtToken = token.<span class="hljs-title function_">replace</span>(<span class="hljs-string">&quot;JWT &quot;</span>, <span class="hljs-string">&quot;&quot;</span>);

  <span class="hljs-variable constant_">JWT</span>.<span class="hljs-title function_">verify</span>(jwtToken, process.<span class="hljs-property">env</span>.<span class="hljs-property">PASSPORT_SECRET</span>, <span class="hljs-function">(<span class="hljs-params">err, user</span>) =&gt;</span> &#123;
    <span class="hljs-keyword">if</span> (err) &#123;
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">403</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;ç„¡æ•ˆçš„ token&quot;</span>);
    &#125;
    req.<span class="hljs-property">user</span> = user; <span class="hljs-comment">// ä¿å­˜è§£æå¾Œçš„ç”¨æˆ¶ä¿¡æ¯</span>
    <span class="hljs-title function_">next</span>(); <span class="hljs-comment">// é€šéé©—è­‰ï¼Œç¹¼çºŒåŸ·è¡Œå¾ŒçºŒçš„è·¯ç”±</span>
  &#125;);
&#125;
</code></pre>
<h3 id="6-å»ºç«‹-express-å¾Œç«¯-api"><a class="markdownIt-Anchor" href="#6-å»ºç«‹-express-å¾Œç«¯-api"></a> 6. å»ºç«‹ Express å¾Œç«¯ API</h3>
<p>è¨­è¨ˆ RESTful APIï¼Œä¾‹å¦‚ç”¨æ–¼ç®¡ç†ç”¨æˆ¶çš„ CRUD åŠŸèƒ½ï¼š</p>
<pre class="highlight"><code class="js"><span class="hljs-keyword">const</span> router = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>).<span class="hljs-title class_">Router</span>();
<span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../model&quot;</span>).<span class="hljs-property">user</span>;
<span class="hljs-keyword">const</span> bcrypt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;bcrypt&quot;</span>); <span class="hljs-comment">//ç”¨æ–¼åŠ å¯†ç”¨æˆ¶è¨Šæ¯ ex.password</span>

<span class="hljs-keyword">const</span> registerValidation = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../validation&quot;</span>).<span class="hljs-property">registorValidation</span>;
<span class="hljs-keyword">const</span> loginValidation = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../validation&quot;</span>).<span class="hljs-property">loginValidation</span>;
<span class="hljs-keyword">const</span> editorValidation = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../validation&quot;</span>).<span class="hljs-property">editorValidation</span>;

<span class="hljs-comment">// å»ºç«‹ä½¿ç”¨è€…</span>
router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/register&quot;</span>, <span class="hljs-title function_">async</span> (req, res) =&gt; &#123;
  <span class="hljs-keyword">let</span> &#123; username, email, password, role &#125; = req.<span class="hljs-property">body</span>;
  <span class="hljs-keyword">let</span> &#123; error &#125; = <span class="hljs-title function_">registerValidation</span>(req.<span class="hljs-property">body</span>); <span class="hljs-comment">//ç¢ºèªæ•¸æ“šæ˜¯å¦ç¬¦åˆè¦å®š</span>
  <span class="hljs-keyword">if</span> (error) &#123;
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">send</span>(error.<span class="hljs-property">details</span>[<span class="hljs-number">0</span>].<span class="hljs-property">message</span>);
  &#125;
  <span class="hljs-keyword">const</span> emailExist = <span class="hljs-keyword">await</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">findOne</span>(&#123; email &#125;).<span class="hljs-title function_">exec</span>();
  <span class="hljs-keyword">if</span> (emailExist) &#123;
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;è©²ä¿¡ç®±å·²è¢«è¨»å†Œï¼Œè«‹æ›´æ¢åˆ¥çš„ä¿¡ç®±ã€‚&quot;</span>);
  &#125;
  <span class="hljs-keyword">try</span> &#123;
    <span class="hljs-keyword">let</span> newUser = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(&#123; username, email, password, role &#125;);
    <span class="hljs-keyword">await</span> newUser.<span class="hljs-title function_">save</span>();
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">send</span>(&#123;
      <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;ä½¿ç”¨è€…æˆåŠŸå„²å­˜&quot;</span>,
      <span class="hljs-attr">user</span>: &#123;
        <span class="hljs-attr">id</span>: newUser.<span class="hljs-property">_id</span>,
        <span class="hljs-attr">username</span>: newUser.<span class="hljs-property">username</span>,
        <span class="hljs-attr">email</span>: newUser.<span class="hljs-property">email</span>,
        <span class="hljs-attr">password</span>: newUser.<span class="hljs-property">password</span>,
        <span class="hljs-attr">role</span>: newUser.<span class="hljs-property">role</span>,
      &#125;,
    &#125;);
  &#125; <span class="hljs-keyword">catch</span> (e) &#123;
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;ç„¡æ³•å„²å­˜ä½¿ç”¨è€…&quot;</span>);
  &#125;
&#125;);

<span class="hljs-comment">//ç”¨æˆ¶ç™»å…¥</span>
router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/login&quot;</span>, <span class="hljs-title function_">async</span> (req, res) =&gt; &#123;
  <span class="hljs-keyword">let</span> &#123; email, password &#125; = req.<span class="hljs-property">body</span>;
  <span class="hljs-keyword">let</span> &#123; error &#125; = <span class="hljs-title function_">loginValidation</span>(req.<span class="hljs-property">body</span>);
  <span class="hljs-keyword">if</span> (error) &#123;
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">send</span>(error.<span class="hljs-property">details</span>[<span class="hljs-number">0</span>].<span class="hljs-property">message</span>);
  &#125;
  <span class="hljs-keyword">const</span> <span class="hljs-title class_">FUser</span> = <span class="hljs-keyword">await</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">findOne</span>(&#123; email &#125;).<span class="hljs-title function_">exec</span>();
  <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">FUser</span>) &#123;
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;æ‰¾ä¸åˆ°æ­¤ç”¨æˆ¶ï¼Œè«‹ç¢ºèªä¿¡ç®±æ˜¯å¦æ­£ç¢ºã€‚&quot;</span>);
  &#125;
  <span class="hljs-title class_">FUser</span>.<span class="hljs-title function_">comparePassword</span>(password, <span class="hljs-function">(<span class="hljs-params">err, isMatch</span>) =&gt;</span> &#123;
    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">send</span>(err);
    <span class="hljs-keyword">if</span> (isMatch) &#123;
      <span class="hljs-keyword">const</span> tokenObj = &#123; <span class="hljs-attr">_id</span>: <span class="hljs-title class_">FUser</span>.<span class="hljs-property">_id</span>, <span class="hljs-attr">email</span>: <span class="hljs-title class_">FUser</span>.<span class="hljs-property">email</span> &#125;;
      <span class="hljs-keyword">const</span> token = <span class="hljs-variable constant_">JWT</span>.<span class="hljs-title function_">sign</span>(tokenObj, process.<span class="hljs-property">env</span>.<span class="hljs-property">PASSPORT_SECRET</span>);
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">send</span>(&#123;
        <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;æˆåŠŸç™»å…¥&quot;</span>,
        <span class="hljs-attr">token</span>: <span class="hljs-string">&quot;JWT &quot;</span> + token,
        <span class="hljs-attr">user</span>: <span class="hljs-title class_">FUser</span>,
      &#125;);
    &#125; <span class="hljs-keyword">else</span> &#123;
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;å¯†ç¢¼éŒ¯èª¤&quot;</span>);
    &#125;
  &#125;);
&#125;);

<span class="hljs-comment">//ç”¨æˆ¶è³‡æ–™ä¿®æ”¹</span>
router.<span class="hljs-title function_">patch</span>(<span class="hljs-string">&quot;/:_id&quot;</span>, authenticateToken, <span class="hljs-title function_">async</span> (req, res) =&gt; &#123;
  <span class="hljs-keyword">let</span> &#123; _id &#125; = req.<span class="hljs-property">params</span>;

  <span class="hljs-comment">// é©—è­‰è«‹æ±‚æ•¸æ“š</span>
  <span class="hljs-keyword">let</span> &#123; error &#125; = <span class="hljs-title function_">editorValidation</span>(req.<span class="hljs-property">body</span>);
  <span class="hljs-keyword">if</span> (error) &#123;
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">error</span>: error.<span class="hljs-property">details</span>[<span class="hljs-number">0</span>].<span class="hljs-property">message</span> &#125;); <span class="hljs-comment">// è¿”å›å…·é«”éŒ¯èª¤ä¿¡æ¯</span>
  &#125;

  <span class="hljs-keyword">try</span> &#123;
    <span class="hljs-comment">// æŸ¥æ‰¾ç”¨æˆ¶</span>
    <span class="hljs-keyword">let</span> <span class="hljs-title class_">Uf</span> = <span class="hljs-keyword">await</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">findById</span>(_id).<span class="hljs-title function_">exec</span>();
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Uf</span>) &#123;
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">404</span>).<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">error</span>: <span class="hljs-string">&quot;æ‰¾ä¸åˆ°æ­¤ç”¨æˆ¶&quot;</span> &#125;); <span class="hljs-comment">// ç”¨æˆ¶æœªæ‰¾åˆ°</span>
    &#125;

    <span class="hljs-comment">// é©—è­‰ç•¶å‰ç”¨æˆ¶æ˜¯å¦èˆ‡è¦ä¿®æ”¹çš„ç”¨æˆ¶ç›¸åŒ</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Uf</span>.<span class="hljs-property">_id</span>.<span class="hljs-title function_">toString</span>() === req.<span class="hljs-property">user</span>.<span class="hljs-property">_id</span>.<span class="hljs-title function_">toString</span>()) &#123;
      <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(req.<span class="hljs-property">body</span>).<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) &#123;
        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">error</span>: <span class="hljs-string">&quot;æ²’æœ‰æä¾›æ›´æ–°è³‡æ–™&quot;</span> &#125;);
      &#125;

      <span class="hljs-keyword">let</span> updatedData = req.<span class="hljs-property">body</span>;

      <span class="hljs-comment">// å¦‚æœæœ‰æä¾›å¯†ç¢¼ï¼Œå‰‡é€²è¡ŒåŠ å¯†è™•ç†</span>
      <span class="hljs-keyword">if</span> (updatedData.<span class="hljs-property">password</span>) &#123;
        <span class="hljs-keyword">const</span> salt = <span class="hljs-keyword">await</span> bcrypt.<span class="hljs-title function_">genSalt</span>(<span class="hljs-number">10</span>); <span class="hljs-comment">// ç”Ÿæˆsalt</span>
        updatedData.<span class="hljs-property">password</span> = <span class="hljs-keyword">await</span> bcrypt.<span class="hljs-title function_">hash</span>(updatedData.<span class="hljs-property">password</span>, salt); <span class="hljs-comment">// ä½¿ç”¨saltåŠ å¯†å¯†ç¢¼</span>
      &#125;

      <span class="hljs-comment">// æ›´æ–°ç”¨æˆ¶è³‡æ–™</span>
      <span class="hljs-keyword">const</span> updatedUser = <span class="hljs-keyword">await</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">findByIdAndUpdate</span>(_id, updatedData, &#123;
        <span class="hljs-attr">new</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">runValidators</span>: <span class="hljs-literal">true</span>,
      &#125;);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(updatedUser);

      <span class="hljs-keyword">if</span> (!updatedUser) &#123;
        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">error</span>: <span class="hljs-string">&quot;æ›´æ–°å¤±æ•—&quot;</span> &#125;);
      &#125;

      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;è³‡æ–™è¢«æ›´æ–°&quot;</span>, <span class="hljs-attr">user</span>: updatedUser &#125;);
    &#125; <span class="hljs-keyword">else</span> &#123;
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">403</span>).<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">error</span>: <span class="hljs-string">&quot;æ‚¨ç„¡æ¬Šæ›´æ”¹æ­¤è³‡æ–™&quot;</span> &#125;); <span class="hljs-comment">// æ¬Šé™éŒ¯èª¤</span>
    &#125;
  &#125; <span class="hljs-keyword">catch</span> (e) &#123;
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">error</span>: e.<span class="hljs-property">message</span> &#125;); <span class="hljs-comment">// ä¼ºæœå™¨éŒ¯èª¤</span>
  &#125;
&#125;);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;
</code></pre>

    </div>
    
    
    
    
    
    
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2024 - 2024 HenRsã®å°çª©
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;HenRs
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js" defer></script>
    
    




    
    <canvas
        id="fireworks"
        style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 32767"
    ></canvas>
    <script src="https://s4.zstatic.net/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="/js/fireworks.min.js" defer></script>
    <script src="/js/pagenation.min.js" defer></script>
</body>
</html>